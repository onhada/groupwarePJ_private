<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="reservation">


	<!-- === 자원카테고리 목록 가져오기 === --> 
	<resultMap type="HashMap" id="getResourceCategoryList_Map">
	    <result property="resourceCategoryId" 		column="resourceCategoryId" 	javaType="String" />
	    <result property="resourceCategoryName" 	column="resourceCategoryName" 	javaType="String" />
	</resultMap>
	<select id="getResourceCategoryList" resultMap="getResourceCategoryList_Map">
		select resourceCategoryId, resourceCategoryName
		from tbl_resourceCategory
		where isDelete = 0
		order by resourceCategoryId asc
	</select>
	
	
	<!-- === 자원 목록 가져오기 === --> 
	<resultMap type="HashMap" id="getResourceList_Map">
	    <result property="resourceId" 				column="resourceId" 			javaType="String" />
	    <result property="fk_resourceCategoryId" 	column="fk_resourceCategoryId" 	javaType="String" />
	    <result property="resourceName" 			column="resourceName" 			javaType="String" />
	    <result property="description" 				column="description" 			javaType="String" />
	    <result property="imageFile" 				column="imageFile" 				javaType="String" />
	    <result property="status" 					column="status" 				javaType="String" />
	    <result property="isReturn" 				column="isReturn" 				javaType="String" />
	</resultMap>
	<select id="getResourceList" parameterType="HashMap" resultMap="getResourceList_Map">
		select resourceId, fk_resourceCategoryId, resourceName, description, imageFile, status, isReturn
		from tbl_resource
		where isDelete = 0 and fk_resourceCategoryId = #{resourceCategoryId}
		order by resourceId asc		
	</select>
	
	
	<!-- === 자원카테고리 정보 가져오기 === --> 
	<resultMap type="HashMap" id="getResourceCategoryInfo_map">
	    <result property="resourceCategoryId" 		column="resourceCategoryId" 	javaType="String" />
	    <result property="resourceCategoryName" 	column="resourceCategoryName" 	javaType="String" />
	    <result property="description" 				column="description" 			javaType="String" />
	    <result property="imageFile" 				column="imageFile" 				javaType="String" />
	</resultMap>
	<select id="getResourceCategoryInfo" parameterType="HashMap" resultMap="getResourceCategoryInfo_map">
		select resourceCategoryId, resourceCategoryName, description, imageFile
		from tbl_resourceCategory
		where isDelete = 0 and resourceCategoryId = #{resourceCategoryId}
		order by resourceCategoryId asc
	</select>
	
	
	<!-- === 자원 정보 가져오기 === --> 
	<resultMap type="HashMap" id="getResourceInfo_map">
	    <result property="resourceId" 				column="resourceId" 			javaType="String" />
	    <result property="fk_resourceCategoryId" 	column="fk_resourceCategoryId" 	javaType="String" />
	    <result property="resourceName" 			column="resourceName" 			javaType="String" />
	    <result property="description" 				column="description" 			javaType="String" />
	    <result property="imageFile" 				column="imageFile" 				javaType="String" />
	</resultMap>
	<select id="getResourceInfo" parameterType="HashMap" resultMap="getResourceInfo_map">
		select resourceId, fk_resourceCategoryId, resourceName, description, imageFile
		from tbl_resource
		where isDelete = 0 and resourceId = #{resourceId}
		order by resourceId asc
	</select>
	
	
	<!-- === 모든 자원 목록 가져오기 === -->
	<resultMap type="HashMap" id="getAllResourceList_map">
	    <result property="resourceId" 				column="resourceId" 			javaType="String" />
	    <result property="fk_resourceCategoryId" 	column="fk_resourceCategoryId" 	javaType="String" />
	    <result property="resourceName" 			column="resourceName" 			javaType="String" />
	</resultMap>
	<select id="getAllResourceList" resultMap="getAllResourceList_map">
		select resourceId, fk_resourceCategoryId, resourceName
		from tbl_resource
		where isDelete = 0 
		order by fk_resourceCategoryId asc, resourceId asc
	</select>
	
	
	<!-- === 해당일시에 등록된 예약이 있는지 조회 === -->
	<resultMap type="HashMap" id="selectReservation_map">
	    <result property="rsvResourceId"		column="rsvResourceId" 			javaType="String" />
	</resultMap>
	<select id="selectReservation" parameterType="HashMap" resultMap="selectReservation_map">
		<![CDATA[
		select rsvResourceId
		from tbl_reservationResource
		where fk_resourceId = #{resourceId} 
		      and (
		              ( #{rsvStartDayTime} <= rsvStartDayTime and ( rsvStartDayTime <= #{rsvEndDayTime} and #{rsvEndDayTime} <= rsvEndDayTime ) )
		           or ( rsvStartDayTime <= #{rsvStartDayTime} and  #{rsvEndDayTime} <= rsvEndDayTime )
		           or ( (rsvStartDayTime <= #{rsvStartDayTime} and #{rsvStartDayTime} <= rsvEndDayTime) and rsvEndDayTime <= #{rsvEndDayTime} )
		           or ( #{rsvStartDayTime} <= rsvStartDayTime and rsvEndDayTime <= #{rsvEndDayTime} )
		          )	
		]]>          	
	</select>
	
	
	<!-- === 예약하기 (자원예약 table에 insert) === -->
	<insert id="addReservation" parameterType="HashMap">
		<!-- 원메일쓰기인 경우 -->
		<if test='orgMailId.equals("0")'> 
			insert into tbl_mail(mailId, subject, mailContent, sendDay, orgMailId)
			values(mailSeq.nextval, #{subject}, #{mailContent}, sysdate, default)		 
		</if>
		<!-- 답장메일쓰기인 경우 -->
		<if test='!orgMailId.equals("0")'>
			insert into tbl_mail(mailId, subject, mailContent, sendDay, orgMailId)
			values(mailSeq.nextval, #{subject}, #{mailContent}, sysdate, #{orgMailId})
		</if>
	</insert>
	
	
	<!-- === 승인여부, 반납필수여부 알아오기 === -->
	<resultMap type="HashMap" id="getResourceOption_map">
	    <result property="resourceId" 				column="resourceId" 			javaType="String" />
	    <result property="fk_resourceCategoryId" 	column="fk_resourceCategoryId" 	javaType="String" />
	    <result property="resourceName" 			column="resourceName" 			javaType="String" />
	    <result property="description" 				column="description" 			javaType="String" />
	    <result property="imageFile" 				column="imageFile" 				javaType="String" />
	</resultMap>
	<select id="getResourceOption" parameterType="String" resultMap="getResourceOption_map">
		select status, isReturn
		from tbl_resource
		where resourceId = #{resourceId}
	</select>
	
	
	
	
	
</mapper>	